#include <stdio.h>
#include <stdlib.h>
#include <time.h>

typedef struct Item {
    int itemId;
    int weight;
    int profit;
    float pByW;
} Item;

int compareItems(const void *a, const void *b) {
    Item *itemA = (Item *)a;
    Item *itemB = (Item *)b;

    if (itemB->pByW > itemA->pByW) return 1;
    if (itemB->pByW < itemA->pByW) return -1;
    return 0;
}

float fractionalKnapsack(Item items[], int n, int capacity) {
    float totalProfit = 0.0;
    int currentWeight = 0;
    int i;

    qsort(items, n, sizeof(Item), compareItems);

    for (i = 0; i < n; i++) {
        if (currentWeight + items[i].weight <= capacity) {
            currentWeight += items[i].weight;
            totalProfit += items[i].profit;
            printf("Added item %d (Weight: %d, Profit: %d) completely. Current Weight: %d, Total Profit: %.2f\n", items[i].itemId, items[i].weight, items[i].profit, currentWeight, totalProfit);
        } else {
            float remainingCapacity = capacity - currentWeight;
            float fraction = remainingCapacity / items[i].weight;
            totalProfit += fraction * items[i].profit;
            currentWeight += remainingCapacity; 
            printf("Added %.2f%% of item %d (Weight: %d, Profit: %d). Current Weight: %d, Total Profit: %.2f\n", fraction * 100, items[i].itemId, items[i].weight, items[i].profit, currentWeight, totalProfit);
            break;
        }
    }

    return totalProfit;
}

int main() {
    int n, knapsackCapacity;
    int i;
    clock_t start, end;
    double cpu_time_used;

    printf("Enter the number of items: ");
    scanf("%d", &n);

    Item *items = (Item *)malloc(sizeof(Item) * n);

    if (items == NULL) {
        printf("Memory allocation failed!\n");
        return 1;
    }

    start = clock();

    printf("Enter itemID, Weight and Profit:\n");
    for (i = 0; i < n; i++) {
        scanf("%d %d %d", &items[i].itemId, &items[i].weight, &items[i].profit);
        items[i].pByW = (float)items[i].profit / items[i].weight;
    }

    printf("Enter the knapsack Capacity: ");
    scanf("%d", &knapsackCapacity);

    float maxProfit = fractionalKnapsack(items, n, knapsackCapacity);

    end = clock();

    printf("\nMaximum profit for the given capacity: %.2f\n", maxProfit);

    free(items);

    cpu_time_used = ((double)(end - start)) / CLOCKS_PER_SEC;
    printf("Execution time: %f seconds\n", cpu_time_used);

    // Note: 'getch()' and 'clrscr()' are non-standard and have been removed.

    return 0;
}
